{"version":3,"sources":["../../src/transactions/retrieve-data.js"],"names":["processResults","results","length","connection","tableName","predicate","id","rethinkdb","table","run","then","cursor","toArray","err","Object","keys","get","result","logger","info","JSON","stringify","filter"],"mappings":";;;;;;;;;;;;;AAIA;;AACA;;AALA;;;;;AAOA;;;;;;;AAOA,IAAMA,cAAc,GAAG,SAAjBA,cAAiB,CAAAC,OAAO;AAAA,SAAKA,OAAO,IAAIA,OAAO,CAACC,MAAR,GAAiB,CAA5B,GAAgCD,OAAO,CAAC,CAAD,CAAvC,GAA6CA,OAAlD;AAAA,CAA9B;AAEA;;;;;;;;;;;;;;;+BAQe,iBAAOE,UAAP,EAAmBC,SAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8BC,YAAAA,SAA9B,2DAA0C,EAA1C;AACLC,YAAAA,EADK,GACED,SADF,CACLC,EADK;;AAAA,gBAGRD,SAHQ;AAAA;AAAA;AAAA;;AAAA,6CAIJE,sBACJC,KADI,CACEJ,SADF,EAEJK,GAFI,CAEAN,UAFA,EAGJO,IAHI,CAGC,UAAAC,MAAM;AAAA,qBACVA,MAAM,CAACC,OAAP,CAAe,UAACC,GAAD,EAAMZ,OAAN,EAAkB;AAC/B,oBAAIY,GAAJ,EAAS,MAAMA,GAAN;AAET,uBAAOb,cAAc,CAACC,OAAD,CAArB;AACD,eAJD,CADU;AAAA,aAHP,CAJI;;AAAA;AAAA,kBAgBTK,EAAE,IAAIQ,MAAM,CAACC,IAAP,CAAYV,SAAZ,EAAuBH,MAAvB,KAAkC,CAhB/B;AAAA;AAAA;AAAA;;AAAA,6CAiBJK,sBACJC,KADI,CACEJ,SADF,EAEJY,GAFI,CAEAV,EAFA,EAGJG,GAHI,CAGAN,UAHA,EAIJO,IAJI,CAIC,UAAAO,MAAM;AAAA,qBAAIA,MAAJ;AAAA,aAJP,CAjBI;;AAAA;AAwBbC,oCAAOC,IAAP,yCAA6CC,IAAI,CAACC,SAAL,CAAehB,SAAf,CAA7C;;AAxBa,6CA0BNE,sBACJC,KADI,CACEJ,SADF,EAEJkB,MAFI,CAEGjB,SAFH,EAGJI,GAHI,CAGAN,UAHA,EAIJO,IAJI,CAIC,UAAAC,MAAM;AAAA,qBACVA,MAAM,CAACC,OAAP,CAAe,UAACC,GAAD,EAAMZ,OAAN,EAAkB;AAC/B,oBAAIY,GAAJ,EAAS,MAAMA,GAAN;;AACTK,wCAAOC,IAAP,0BAA8BlB,OAAO,CAACC,MAAtC;;AACA,uBAAOF,cAAc,CAACC,OAAD,CAArB;AACD,eAJD,CADU;AAAA,aAJP,CA1BM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["/**\n * Retrieve data module\n * @memberof rethinkly\n */\nimport rethinkdb from 'rethinkdb'\nimport logger from 'hoopa-logger'\n\n/**\n * ProcessResults\n * Callback to process data on gathering, for now don't\n * need any transformation\n * @param {Array} results\n * @return {Array} results\n */\nconst processResults = results => (results && results.length > 0 ? results[0] : results)\n\n/**\n * RetrieveData\n * Grab data from database\n * @param {Object} connection\n * @param {String} tableName\n * @param {String} predicate?\n * @returns {Array||Object} results || result\n */\nexport default async (connection, tableName, predicate = {}) => {\n  const { id } = predicate\n\n  if (!predicate) {\n    return rethinkdb\n      .table(tableName)\n      .run(connection)\n      .then(cursor =>\n        cursor.toArray((err, results) => {\n          if (err) throw err\n\n          return processResults(results)\n        })\n      )\n  }\n\n  if (id && Object.keys(predicate).length === 1) {\n    return rethinkdb\n      .table(tableName)\n      .get(id)\n      .run(connection)\n      .then(result => result)\n  }\n\n  logger.info(`Searching using the predicate ${JSON.stringify(predicate)}`)\n\n  return rethinkdb\n    .table(tableName)\n    .filter(predicate)\n    .run(connection)\n    .then(cursor =>\n      cursor.toArray((err, results) => {\n        if (err) throw err\n        logger.info(`Search resuls: ${results.length}`)\n        return processResults(results)\n      })\n    )\n}\n"],"file":"retrieve-data.js"}